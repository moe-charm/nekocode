# ğŸ› NekoCodeæ–°æ©Ÿèƒ½ãƒã‚°ä¿®æ­£è¨ˆç”»æ›¸
ä½œæˆæ—¥: 2025-07-30
å¯¾è±¡: structure --detailed, complexity --methods, calls --detailed ã‚³ãƒãƒ³ãƒ‰

## ğŸ“Š ç™ºè¦‹ã•ã‚ŒãŸãƒã‚°è©³ç´°

### 1. **structure --detailed ãƒã‚°**
**ç—‡çŠ¶**: `{"classes": [], "command": "structure-detailed", "file": "xxx.cpp"}`
**æœŸå¾…å€¤**: ã‚¯ãƒ©ã‚¹æƒ…å ±ã‚’å«ã‚€è©³ç´°ãªæ§‹é€ è§£æçµæœ
**å½±éŸ¿åº¦**: ğŸ”´ High - Claude Codeã‹ã‚‰å¼·ãè¦æ±‚ã•ã‚ŒãŸæ©Ÿèƒ½

### 2. **complexity --methods ãƒã‚°**  
**ç—‡çŠ¶**: `{"method_complexity": [], "total_methods": 0}`
**æœŸå¾…å€¤**: ãƒ•ã‚¡ã‚¤ãƒ«å†…ã®ãƒ¡ã‚½ãƒƒãƒ‰åˆ¥è¤‡é›‘åº¦ãƒ©ãƒ³ã‚­ãƒ³ã‚°
**å½±éŸ¿åº¦**: ğŸ”´ High - ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°åˆ¤æ–­ã«å¿…è¦

### 3. **calls --detailed ãƒã‚°**
**ç—‡çŠ¶**: `{"error": "æŒ‡å®šã•ã‚ŒãŸé–¢æ•° 'xxx' ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"}`
**æœŸå¾…å€¤**: é–¢æ•°ã®å‘¼ã³å‡ºã—ãƒ»è¢«å‘¼ã³å‡ºã—é–¢ä¿‚ã®è©³ç´°æƒ…å ±
**å½±éŸ¿åº¦**: ğŸŸ¡ Medium - é–¢æ•°ä¾å­˜é–¢ä¿‚åˆ†æã«ä½¿ç”¨

## ğŸ” æ ¹æœ¬åŸå› åˆ†æ

### **åŸå› 1: ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å•é¡Œ**
```cpp
// æ¨æ¸¬ã•ã‚Œã‚‹å•é¡Œç®‡æ‰€ (session_manager.cpp)
nlohmann::json SessionManager::cmd_structure_detailed(const SessionData& session, const std::string& filename) const {
    // âŒ å•é¡Œ: DirectoryAnalysisã‹ã‚‰ç‰¹å®šãƒ•ã‚¡ã‚¤ãƒ«ã®è©³ç´°æƒ…å ±ã‚’å–å¾—ã™ã‚‹æ–¹æ³•ãŒä¸é©åˆ‡
    // session.directory_result.files[?].classes ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¦ã„ãªã„
}
```

### **åŸå› 2: ãƒ‡ãƒ¼ã‚¿æ§‹é€ ç†è§£ä¸è¶³**
- `SessionData` æ§‹é€ ä½“ã® `directory_result.files` é…åˆ—å†…ã® `AnalysisResult` ã‚¢ã‚¯ã‚»ã‚¹æ–¹æ³•
- ãƒ•ã‚¡ã‚¤ãƒ«åã‹ã‚‰ã®å¯¾å¿œã™ã‚‹ `AnalysisResult` æ¤œç´¢ãƒ­ã‚¸ãƒƒã‚¯ä¸å‚™
- ã‚¯ãƒ©ã‚¹ãƒ»ãƒ¡ã‚½ãƒƒãƒ‰æƒ…å ±ã®éšå±¤æ§‹é€ ã¸ã®ä¸é©åˆ‡ãªã‚¢ã‚¯ã‚»ã‚¹

### **åŸå› 3: é–¢æ•°æ¤œç´¢ãƒ­ã‚¸ãƒƒã‚¯å•é¡Œ**
- å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã®é–¢æ•°åæ¤œç´¢ãŒå®Ÿè£…ã•ã‚Œã¦ã„ãªã„
- `FunctionInfo` æ§‹é€ ä½“ã¸ã®é©åˆ‡ãªã‚¢ã‚¯ã‚»ã‚¹æ–¹æ³•ä¸å‚™

## ğŸ› ï¸ ä¿®æ­£è¨ˆç”»ï¼ˆPhaseåˆ¥ï¼‰

### **Phase 1: ãƒ‡ãƒ¼ã‚¿æ§‹é€ èª¿æŸ»** ğŸ”
**ç›®æ¨™**: ã‚»ãƒƒã‚·ãƒ§ãƒ³å†…ã®ãƒ‡ãƒ¼ã‚¿ä¿å­˜çŠ¶æ³ã‚’æ­£ç¢ºã«æŠŠæ¡

```bash
# å®Ÿè¡Œæ‰‹é †
1. ã‚»ãƒƒã‚·ãƒ§ãƒ³JSONãƒ•ã‚¡ã‚¤ãƒ«ç›´æ¥ç¢ºèª
   cat sessions/ai_session_20250730_223414.json | python3 -m json.tool | head -100

2. SessionDataæ§‹é€ ä½“ã®ãƒ¡ãƒ³ãƒãƒ¼ç¢ºèª
   - directory_result.files[i].classes ã®å†…å®¹
   - directory_result.files[i].functions ã®å†…å®¹
   - ãƒ•ã‚¡ã‚¤ãƒ«åã¨AnalysisResultã®å¯¾å¿œé–¢ä¿‚

3. types.hppã®æ§‹é€ ä½“å®šç¾©å†ç¢ºèª
   - ClassInfo, FunctionInfo, AnalysisResult ã®å®Ÿéš›ã®æ§‹é€ 
```

### **Phase 2: structure --detailed ä¿®æ­£** ğŸ—ï¸
**ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ**: `cmd_structure_detailed()` é–¢æ•°ä¿®æ­£

```cpp
// ä¿®æ­£äºˆå®šã‚³ãƒ¼ãƒ‰æ§‹é€ 
nlohmann::json SessionManager::cmd_structure_detailed(const SessionData& session, const std::string& filename) const {
    // 1. ãƒ•ã‚¡ã‚¤ãƒ«åã‹ã‚‰AnalysisResultæ¤œç´¢
    for (const auto& file_result : session.directory_result.files) {
        if (file_result.file_info.name == filename) {
            // 2. ã‚¯ãƒ©ã‚¹æƒ…å ±æŠ½å‡º
            json result;
            result["classes"] = json::array();
            
            for (const auto& class_info : file_result.classes) {
                json class_obj;
                class_obj["name"] = class_info.name;
                class_obj["start_line"] = class_info.start_line;
                class_obj["end_line"] = class_info.end_line;
                class_obj["methods"] = json::array();
                
                // 3. ãƒ¡ã‚½ãƒƒãƒ‰æƒ…å ±è¿½åŠ 
                for (const auto& method : class_info.methods) {
                    json method_obj;
                    method_obj["name"] = method.name;
                    method_obj["complexity"] = method.complexity.cyclomatic_complexity;
                    method_obj["parameters"] = method.parameters;
                    class_obj["methods"].push_back(method_obj);
                }
                
                result["classes"].push_back(class_obj);
            }
            return result;
        }
    }
    // 4. ãƒ•ã‚¡ã‚¤ãƒ«æœªç™ºè¦‹ã‚¨ãƒ©ãƒ¼å‡¦ç†
}
```

### **Phase 3: complexity --methods ä¿®æ­£** ğŸ“Š
**ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ**: `cmd_complexity_methods()` é–¢æ•°ä¿®æ­£

```cpp
// ä¿®æ­£æˆ¦ç•¥
nlohmann::json SessionManager::cmd_complexity_methods(const SessionData& session, const std::string& filename) const {
    // 1. æŒ‡å®šãƒ•ã‚¡ã‚¤ãƒ«ã®å…¨ãƒ¡ã‚½ãƒƒãƒ‰æŠ½å‡ºï¼ˆã‚¯ãƒ©ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰ï¼‹å˜ç‹¬é–¢æ•°ï¼‰
    // 2. è¤‡é›‘åº¦ã§ã‚½ãƒ¼ãƒˆï¼ˆé™é †ï¼‰
    // 3. JSONå½¢å¼ã§å‡ºåŠ›
    
    json result;
    result["method_complexity"] = json::array();
    
    // è¤‡é›‘åº¦æƒ…å ±ã‚’é…åˆ—ã«é›†ç´„
    std::vector<std::pair<std::string, int>> method_complexities;
    
    // ã‚¯ãƒ©ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰ã‹ã‚‰æŠ½å‡º
    for (const auto& class_info : file_result.classes) {
        for (const auto& method : class_info.methods) {
            method_complexities.push_back({
                class_info.name + "::" + method.name,
                method.complexity.cyclomatic_complexity
            });
        }
    }
    
    // å˜ç‹¬é–¢æ•°ã‹ã‚‰æŠ½å‡º
    for (const auto& function : file_result.functions) {
        method_complexities.push_back({
            function.name,
            function.complexity.cyclomatic_complexity
        });
    }
    
    // ã‚½ãƒ¼ãƒˆãƒ»å‡ºåŠ›
}
```

### **Phase 4: calls --detailed ä¿®æ­£** ğŸ“
**ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ**: `cmd_calls_detailed()` é–¢æ•°ä¿®æ­£

```cpp
// ä¿®æ­£æˆ¦ç•¥
nlohmann::json SessionManager::cmd_calls_detailed(const SessionData& session, const std::string& function_name) const {
    json result;
    result["function"] = function_name;
    result["calls"] = json::array();        // ã“ã®é–¢æ•°ãŒå‘¼ã³å‡ºã™é–¢æ•°ä¸€è¦§
    result["called_by"] = json::array();    // ã“ã®é–¢æ•°ã‚’å‘¼ã³å‡ºã™é–¢æ•°ä¸€è¦§
    
    // 1. å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰æŒ‡å®šé–¢æ•°ã‚’æ¤œç´¢
    bool function_found = false;
    
    for (const auto& file_result : session.directory_result.files) {
        // 2. ã‚¯ãƒ©ã‚¹ãƒ¡ã‚½ãƒƒãƒ‰ã‹ã‚‰æ¤œç´¢
        for (const auto& class_info : file_result.classes) {
            for (const auto& method : class_info.methods) {
                if (method.name == function_name || (class_info.name + "::" + method.name) == function_name) {
                    function_found = true;
                    // ãƒ¡ã‚½ãƒƒãƒ‰ãŒå‘¼ã³å‡ºã™é–¢æ•°ã‚’ function_calls ã‹ã‚‰æŠ½å‡º
                }
            }
        }
        
        // 3. å˜ç‹¬é–¢æ•°ã‹ã‚‰æ¤œç´¢
        for (const auto& function : file_result.functions) {
            if (function.name == function_name) {
                function_found = true;
                // é–¢æ•°å‘¼ã³å‡ºã—æƒ…å ±ã‚’è§£æ
            }
        }
        
        // 4. function_callsé…åˆ—ã‹ã‚‰å‘¼ã³å‡ºã—é–¢ä¿‚ã‚’åˆ†æ
        for (const auto& call : file_result.function_calls) {
            if (call.function_name == function_name) {
                // called_by ã«è¿½åŠ 
            }
            // calls ã«è¿½åŠ ã™ã‚‹å ´åˆã®å‡¦ç†
        }
    }
    
    if (!function_found) {
        result["error"] = "æŒ‡å®šã•ã‚ŒãŸé–¢æ•° '" + function_name + "' ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“";
    }
    
    return result;
}
```

## ğŸ§ª ãƒ†ã‚¹ãƒˆè¨ˆç”»

### **ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹è¨­è¨ˆ**
```bash
# 1. åŸºæœ¬å‹•ä½œãƒ†ã‚¹ãƒˆ
./nekocode_ai session-cmd ai_session_20250730_223414 "structure --detailed CoreMessages.h"
# æœŸå¾…: classesé…åˆ—ã«23å€‹ã®ã‚¯ãƒ©ã‚¹æƒ…å ±

./nekocode_ai session-cmd ai_session_20250730_223414 "complexity --methods IEditorCore.h" 
# æœŸå¾…: method_complexityé…åˆ—ã«38å€‹ã®ãƒ¡ã‚½ãƒƒãƒ‰æƒ…å ±

./nekocode_ai session-cmd ai_session_20250730_223414 "calls --detailed some_function_name"
# æœŸå¾…: calls/called_byé…åˆ—ã«å‘¼ã³å‡ºã—é–¢ä¿‚æƒ…å ±

# 2. ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ  
./nekocode_ai session-cmd ai_session_20250730_223414 "structure --detailed nonexistent.cpp"
# æœŸå¾…: é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

# 3. ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ
# - ç©ºãƒ•ã‚¡ã‚¤ãƒ«
# - ã‚¯ãƒ©ã‚¹ãªã—ãƒ•ã‚¡ã‚¤ãƒ«  
# - é–¢æ•°ãªã—ãƒ•ã‚¡ã‚¤ãƒ«
```

### **æ¤œè¨¼ãƒã‚¤ãƒ³ãƒˆ**
1. **ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§**: ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ±è¨ˆã¨è©³ç´°æƒ…å ±ã®ä¸€è‡´
2. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹**: å¤§å‹ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆnlohmann_json.hppï¼‰ã§ã®å¿œç­”æ™‚é–“
3. **JSONå½¢å¼**: ã™ã¹ã¦ã®å‡ºåŠ›ãŒæœ‰åŠ¹ãªJSONæ§‹é€ 
4. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**: ç•°å¸¸ã‚±ãƒ¼ã‚¹æ™‚ã®é©åˆ‡ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

## âš ï¸ æƒ³å®šã•ã‚Œã‚‹èª²é¡Œã¨å¯¾ç­–

### **èª²é¡Œ1: ãƒ•ã‚¡ã‚¤ãƒ«åã®æ›–æ˜§æ€§**
- **å•é¡Œ**: ãƒ•ã‚¡ã‚¤ãƒ«åã®ã¿æŒ‡å®šæ™‚ã®ä¸€æ„æ€§
- **å¯¾ç­–**: ãƒ•ãƒ«ãƒ‘ã‚¹ã§ã®æ¤œç´¢ã‚‚å¯èƒ½ã«ã™ã‚‹

### **èª²é¡Œ2: å¤§é‡ãƒ‡ãƒ¼ã‚¿ã®å‡¦ç†**
- **å•é¡Œ**: nlohmann_json.hppï¼ˆ123ã‚¯ãƒ©ã‚¹ã€248é–¢æ•°ï¼‰ã§ã®æ€§èƒ½
- **å¯¾ç­–**: ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½è¿½åŠ ã‚’æ¤œè¨

### **èª²é¡Œ3: é–¢æ•°åã®é‡è¤‡**
- **å•é¡Œ**: åŒåé–¢æ•°ãŒè¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã«å­˜åœ¨
- **å¯¾ç­–**: ãƒ•ã‚¡ã‚¤ãƒ«åä»˜ãã§ã®æ¤œç´¢ã‚ªãƒ—ã‚·ãƒ§ãƒ³è¿½åŠ 

## ğŸ¯ æˆåŠŸæŒ‡æ¨™

### **å®šé‡çš„æŒ‡æ¨™**
- structure --detailed: classesé…åˆ—ãŒç©ºã§ãªã„ï¼ˆ>0è¦ç´ ï¼‰
- complexity --methods: total_methods > 0ã€method_complexityé…åˆ—ã«è¦ç´ 
- calls --detailed: æ—¢å­˜é–¢æ•°ã§ error ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãªã—

### **å®šæ€§çš„æŒ‡æ¨™**  
- Claude CodeãŒæœŸå¾…ã™ã‚‹è©³ç´°æƒ…å ±ã®æä¾›
- ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°åˆ¤æ–­ã«å½¹ç«‹ã¤æƒ…å ±ã®å‡ºåŠ›
- ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®æ˜ç¢ºæ€§

## ğŸ“ å®Ÿè£…ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«

```
Phase 1 (èª¿æŸ»): 30åˆ†
â”œâ”€ ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿æ§‹é€ ç¢ºèª
â””â”€ æ—¢å­˜å®Ÿè£…ã‚³ãƒ¼ãƒ‰ç¢ºèª

Phase 2-4 (ä¿®æ­£): 60åˆ†  
â”œâ”€ structure --detailed ä¿®æ­£ (20åˆ†)
â”œâ”€ complexity --methods ä¿®æ­£ (20åˆ†)
â””â”€ calls --detailed ä¿®æ­£ (20åˆ†)

Phase 5 (ãƒ†ã‚¹ãƒˆ): 30åˆ†
â”œâ”€ åŸºæœ¬å‹•ä½œç¢ºèª (15åˆ†)
â””â”€ ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ç¢ºèª (15åˆ†)

ç·æ‰€è¦æ™‚é–“: ç´„2æ™‚é–“
```

## ğŸš€ ä¿®æ­£é–‹å§‹æº–å‚™

**æ¬¡ã®å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰**:
```bash
# 1. ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿æ§‹é€ èª¿æŸ»
cat sessions/ai_session_20250730_223414.json | python3 -m json.tool | head -200

# 2. å®Ÿè£…ãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª
grep -n "cmd_structure_detailed\|cmd_complexity_methods\|cmd_calls_detailed" src/core/session_manager.cpp

# 3. types.hppæ§‹é€ ä½“å®šç¾©ç¢ºèª
grep -A 20 "struct ClassInfo\|struct FunctionInfo" include/nekocode/types.hpp
```

ä¿®æ­£ä½œæ¥­ã®æº–å‚™å®Œäº†ï¼ğŸ”¥