# 🐱 NekoCode 現在の状況と今後のTODO

**作成日**: 2025-07-31 02:40  
**分析者**: Claude Code  
**目的**: メンバ変数検出実装完了後の全体状況整理と次の戦略策定

---

## 📊 言語別メンバ変数検出実装状況

### ✅ **完全実装済み（4言語）**

#### 1. **JavaScript** 🟢
- **実装場所**: `javascript_pegtl_analyzer.hpp`
- **対応パターン**: 
  - `this.property = value` (インスタンスプロパティ)
  - `#privateField = value` (ES2022プライベートフィールド)
  - `property = value` (ES6クラスフィールド)
  - `static property = value` (静的プロパティ)
- **型推論**: string, number, boolean, array, object, any
- **出力**: JSON形式で完全対応 ✅
- **テスト状況**: 動作確認済み（8個のメンバ変数検出）

#### 2. **TypeScript** 🟢
- **実装場所**: `typescript_pegtl_analyzer.hpp`
- **対応パターン**: JavaScript全パターン + TypeScript特化
  - 型注釈対応 `property: Type = value`
  - プロパティ宣言のみ `property: Type;`
  - アクセス修飾子 `private/protected/public`
  - `readonly` 対応
- **型推論**: TypeScript型システム対応
- **出力**: JSON形式で完全対応 ✅
- **テスト状況**: 動作確認済み（シンプルパターン）

#### 3. **Python** 🟢
- **実装場所**: `python_pegtl_analyzer.hpp`
- **対応パターン**:
  - `self.property = value` (インスタンス変数)
  - `variable = value` (クラス変数)
  - `property: Type = value` (Type hints)
  - アクセス修飾子判定（`_protected`, `__private`）
- **型推論**: list, dict, set, str, int, float, bool, None, Any
- **出力**: 実装済みだが確認が必要 ⚠️
- **テスト状況**: 3クラス4関数検出、メンバ変数詳細要確認

#### 4. **C++** 🟡
- **実装場所**: `cpp_pegtl_analyzer.hpp`
- **対応パターン**:
  - クラスメンバ変数検出
  - アクセス修飾子 (private/protected/public)
  - 静的メンバ変数
  - 構造体対応
- **型推論**: C++型システム対応（推定）
- **出力**: 実装されているが詳細出力されない ❌
- **テスト状況**: 4クラス6関数検出、メンバ変数詳細が非表示

### ❌ **未実装（7言語）**

#### 5. **C#** 🔴
- **実装場所**: `csharp_pegtl_analyzer.hpp`
- **現状**: `detect_member_variables` 関数なし
- **必要パターン**:
  - `public/private/protected/internal` 修飾子
  - `static readonly` 対応
  - プロパティ `{ get; set; }` 対応
  - フィールド vs プロパティ区別
- **優先度**: 高（.NET/Unity開発で重要）

#### 6. **Go** 🔴
- **実装場所**: `go_analyzer.hpp`
- **現状**: 基本アナライザーのみ
- **必要パターン**:
  - 構造体フィールド検出
  - エクスポート/非エクスポート判定（大文字/小文字）
  - 埋め込み型対応
- **優先度**: 中

#### 7. **Rust** 🔴
- **実装場所**: `rust_analyzer.hpp`
- **現状**: 基本アナライザーのみ
- **必要パターン**:
  - 構造体フィールド検出
  - `pub` 修飾子対応
  - ライフタイム注釈対応
- **優先度**: 中

#### 8. **Unity C#** 🔴
- **実装場所**: `unity_analyzer.hpp`
- **現状**: Unity特化機能あり、メンバ変数検出なし
- **必要パターン**:
  - Unity特有アトリビュート `[SerializeField]`
  - MonoBehaviour継承クラス対応
  - GameObject参照検出
- **優先度**: 高（ゲーム開発で重要）

#### 9-11. **その他**
- `python_analyzer.hpp` (非PEGTL版): 未実装
- `cpp_language_analyzer.hpp` (旧版): 未実装
- `base_analyzer.hpp`: 基底クラスなので実装不要

---

## 🚨 **緊急課題（即修正が必要）**

### 1. **C++メンバ変数詳細出力問題** 🔥
- **問題**: C++で`detect_member_variables`は実装済みだが、`analyze`コマンドの出力に詳細が含まれない
- **影響**: プロジェクト自体がC++なのに、C++のクラス責務分析ができない
- **解決方法**: `analyze_file`関数でC++用メンバ変数出力処理追加
- **優先度**: 最高

### 2. **Python メンバ変数詳細出力確認** ⚠️
- **問題**: Pythonでも詳細出力されているか未確認
- **解決方法**: テスト実行して確認、必要に応じて修正
- **優先度**: 高

### 3. **デバッグ出力混入問題** 
- **問題**: 標準出力にDEBUGメッセージが混入
- **解決方法**: すべてのDEBUG出力を`std::cerr`へ移動
- **優先度**: 高

---

## 🎯 **今後のTODO（優先順位順）**

### **Phase 1: 緊急修正（今週中）** 🔴

#### TODO-1: C++メンバ変数詳細出力修正
- [ ] `src/core/session_manager.cpp`の`analyze_file`関数確認
- [ ] C++用メンバ変数JSON出力処理追加
- [ ] `test_cpp_analyze.cpp`で動作確認
- [ ] 期待結果: 9個のメンバ変数詳細が出力される

#### TODO-2: Python出力確認・修正
- [ ] `test_py_analyze.py`で詳細出力確認
- [ ] 必要に応じて`analyze_file`でPython対応追加
- [ ] 期待結果: 10+個のメンバ変数詳細出力

#### TODO-3: デバッグ出力クリーンアップ
- [ ] 全`std::cout << "[DEBUG]"`を`std::cerr`へ変更
- [ ] `--quiet`オプション追加（オプション）
- [ ] パイプ処理の改善確認

### **Phase 2: 主要言語対応（2週間以内）** 🟡

#### TODO-4: C#メンバ変数検出実装
- [ ] `csharp_pegtl_analyzer.hpp`に`detect_member_variables`追加
- [ ] C#特有パターン対応（プロパティ、修飾子等）
- [ ] テストファイル作成・動作確認

#### TODO-5: Unity C#特化対応
- [ ] `unity_analyzer.hpp`にメンバ変数検出追加
- [ ] Unity特有アトリビュート対応
- [ ] MonoBehaviour特化処理

#### TODO-6: Go言語対応
- [ ] `go_analyzer.hpp`にメンバ変数検出追加
- [ ] 構造体フィールド検出
- [ ] エクスポート判定

### **Phase 3: 実用機能強化（1ヶ月以内）** 🟢

#### TODO-7: 重複ファイル検出機能
- [ ] `duplicates`コマンド実装
- [ ] `*_backup*`, `*_old*`, `*.bak`パターン検出
- [ ] ファイル類似度計算

#### TODO-8: 大ファイル検出強化
- [ ] `large-files --threshold`オプション
- [ ] 複雑度との組み合わせ表示
- [ ] リファクタリング提案

#### TODO-9: パス解決問題修正
- [ ] セッション作成時の絶対パス保存
- [ ] findコマンドのパス解決改善

### **Phase 4: 将来的拡張（3ヶ月以内）** 🔵

#### TODO-10: Rust対応
- [ ] Rust構造体フィールド検出
- [ ] ライフタイム対応

#### TODO-11: 高度なクラス責務分析
- [ ] メンバ変数使用度分析
- [ ] メソッド-変数依存関係グラフ
- [ ] リファクタリング提案エンジン

#### TODO-12: AI支援機能
- [ ] `suggest-split`コマンド
- [ ] インテリジェントな分割提案
- [ ] `cleanup`コマンド

---

## 📈 **成功指標**

### **Phase 1完了時点**
- C++で9個のメンバ変数詳細が表示される
- Pythonでメンバ変数詳細が正常表示される
- デバッグ出力がクリーンになる

### **Phase 2完了時点**
- 7言語すべてでメンバ変数検出が動作する
- Unity/C#プロジェクトで実用レベルの分析が可能
- Go言語プロジェクトで基本分析が可能

### **最終目標**
- 全言語で「メンバ変数数 × メソッド数 = 責務スコア」が計算できる
- 企業レベルのプロジェクトで実用的なリファクタリング支援が可能
- AI開発者が「革命的な解析ツール」として日常使用する

---

## 🔧 **実装アプローチ**

### **技術戦略**
1. **既存成功パターンの流用**: JavaScript/TypeScript/Pythonの実装を他言語にコピー・改良
2. **段階的実装**: 基本パターン → 言語特化 → 高度機能の順
3. **テスト駆動**: 各言語でテストファイル作成 → 実装 → 検証のサイクル

### **品質保証**
1. **各言語でのテストファイル作成**: 様々なパターンを網羅
2. **実プロジェクトでの検証**: 大規模コードベースでの動作確認
3. **パフォーマンス監視**: メンバ変数検出による処理時間への影響測定

---

**次のアクション**: TODO-1（C++メンバ変数詳細出力修正）から開始

---

*このドキュメントは実装進捗に応じて随時更新されます。*