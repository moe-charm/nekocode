---
title: C++ã®ã‚³ãƒ¼ãƒ‰è§£æãƒ„ãƒ¼ãƒ«ã‹ã‚‰std::regexã‚’å®Œå…¨æ’é™¤ã—ã¦100å€é«˜é€ŸåŒ–ã—ãŸè©±
published: false
tags: cpp, performance, opensource, æ—¥æœ¬èª
cover_image: 
---

## ğŸ¯ ã¯ã˜ã‚ã«ï¼šãªãœstd::regexã‚’æ†ã‚€ã‚ˆã†ã«ãªã£ãŸã®ã‹

ç§ã¯[NekoCode](https://github.com/moe-charm/nekocode)ã¨ã„ã†C++è£½ã®çˆ†é€Ÿã‚³ãƒ¼ãƒ‰è§£æãƒ„ãƒ¼ãƒ«ã‚’é–‹ç™ºã—ã¦ã„ã¾ã™ã€‚ã™ã§ã«Pythonè£½ã®ä»£æ›¿ãƒ„ãƒ¼ãƒ«ã‚ˆã‚Š10-100å€é«˜é€Ÿã ã£ãŸã®ã§ã™ãŒã€ã¾ã æº€è¶³ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚

ãªãœãªã‚‰ã€**std::regex**ãŒãƒœãƒˆãƒ«ãƒãƒƒã‚¯ã ã£ãŸã‹ã‚‰ã§ã™ã€‚

```cpp
// Before: ä¸€è¦‹ç„¡å®³ã«è¦‹ãˆã‚‹ã“ã®ã‚³ãƒ¼ãƒ‰ãŒæ€§èƒ½ã‚’æ®ºã—ã¦ã„ãŸ
std::regex function_regex(R"(function\s+(\w+)\s*\()");
std::smatch matches;
// 959KBã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡¦ç†ã—ã‚ˆã†ã¨ã™ã‚‹ã¨...åœ°ç„
```

## ğŸš€ è§£æ±ºç­–ï¼šPEGTL + ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æˆ¦ç•¥

std::regexã®ä»£ã‚ã‚Šã«[PEGTL](https://github.com/taocpp/PEGTL)ï¼ˆParsing Expression Grammar Template Libraryï¼‰ã‚’ä½¿ã£ãŸãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã‚’å®Ÿè£…ã—ã¾ã—ãŸï¼š

```cpp
// After: PEGTLã§çˆ†é€Ÿãƒ‘ãƒ¼ã‚¹
namespace pegtl = tao::pegtl;

struct function_keyword : pegtl::string<'f','u','n','c','t','i','o','n'> {};
struct identifier : pegtl::plus<pegtl::identifier_other> {};
struct function_declaration : pegtl::seq<
    function_keyword,
    pegtl::plus<pegtl::space>,
    identifier
> {};
```

## ğŸ“Š è¡æ’ƒã®çµæœ

### å®Ÿæˆ¦ãƒ†ã‚¹ãƒˆçµæœï¼ˆ2025å¹´7æœˆï¼‰

| ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ | ã‚µã‚¤ã‚º | æ¤œå‡ºé–¢æ•°æ•° | å‡¦ç†æ™‚é–“ | çŠ¶æ…‹ |
|------------|-------|-----------|---------|------|
| **TypeScriptã‚³ãƒ³ãƒ‘ã‚¤ãƒ©** | 20,700ãƒ•ã‚¡ã‚¤ãƒ« | **2,362** | <5ç§’ | ğŸš€ é©å‘½çš„ |
| **lodash.js** | 544KB | **489** | <1ç§’ | âš¡ å®Ÿç”¨ãƒ¬ãƒ™ãƒ« |
| **nlohmann/json** | 959KB | **254** | <1ç§’ | ğŸ¯ ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚º |

### Before vs After
- **Before**: 4é–¢æ•°æ¤œå‡ºã€é »ç¹ã«ã‚¯ãƒ©ãƒƒã‚·ãƒ¥
- **After**: 2,362é–¢æ•°æ¤œå‡ºã€ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã‚¼ãƒ­
- **æ”¹å–„ç‡**: 590å€ï¼

## ğŸ› ï¸ æŠ€è¡“çš„ãªãƒ–ãƒ¬ãƒ¼ã‚¯ã‚¹ãƒ«ãƒ¼

### 1. å¤§è¦æ¨¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç”¨ã®éåŒæœŸå‡¦ç†
```bash
# 30,000ãƒ•ã‚¡ã‚¤ãƒ«ä»¥ä¸Šã§ã‚‚ãƒ–ãƒ­ãƒƒã‚¯ã—ãªã„
./nekocode_ai session-create-async huge-project/

# ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§é€²æ—ç¢ºèª
tail -f sessions/*/progress.txt
```

### 2. ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ãƒ‡ãƒãƒƒã‚°ãƒ•ãƒ©ã‚°ï¼ˆã‚‚ã†ãƒªã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ä¸è¦ï¼ï¼‰
```cpp
// æ˜”ï¼šã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ãƒ•ãƒ©ã‚°
#ifdef DEBUG
    std::cerr << "ãƒ‡ãƒãƒƒã‚°æƒ…å ±\n";
#endif

// ä»Šï¼šãƒ©ãƒ³ã‚¿ã‚¤ãƒ ãƒ•ãƒ©ã‚°
if (args.debug) {
    std::cerr << "ãƒ‡ãƒãƒƒã‚°æƒ…å ±\n";
}
```

### 3. fork()ã«ã‚ˆã‚‹çœŸã®éåŒæœŸå‡¦ç†
```cpp
pid_t pid = fork();
if (pid == 0) {
    // å­ãƒ—ãƒ­ã‚»ã‚¹ï¼šè§£æå®Ÿè¡Œ
    analyze_project();
    exit(0);
} else {
    // è¦ªãƒ—ãƒ­ã‚»ã‚¹ï¼šå³åº§ã«ãƒªã‚¿ãƒ¼ãƒ³
    std::cout << "éåŒæœŸè§£æé–‹å§‹ã€PID: " << pid << "\n";
}
```

## ğŸ’¡ å­¦ã‚“ã æ•™è¨“

### 1. std::regexã®ç½ 
- **ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚æœ€é©åŒ–ãŒã§ããªã„**
- **å·¨å¤§ãƒ•ã‚¡ã‚¤ãƒ«ã§ãƒ¡ãƒ¢ãƒªã‚’é£Ÿã„æ½°ã™**
- **ã‚¨ãƒ©ãƒ¼å‡¦ç†ãŒè¤‡é›‘**

### 2. PEGTLã®åˆ©ç‚¹
- **ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ã«æœ€é©åŒ–**
- **å‹å®‰å…¨**
- **ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒåˆ†ã‹ã‚Šã‚„ã™ã„**

### 3. ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰æˆ¦ç•¥ã®é‡è¦æ€§
```cpp
// è¨€èªã”ã¨ã®æœ€é©ãªæˆ¦ç•¥
if (language == "javascript") {
    // PEGTLä¸»ä½“ + æœ€å°é™ã®regex
    return analyze_with_pegtl_js(code);
} else if (language == "python") {
    // ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆè§£æã¯æ–‡å­—åˆ—å‡¦ç†
    return analyze_with_string_parsing(code);
}
```

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
è¨€èªã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼/
â”œâ”€â”€ JavaScript â†’ PEGTLï¼ˆãƒ¡ã‚¤ãƒ³ï¼‰+ æœ€å°regexï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
â”œâ”€â”€ TypeScript â†’ PEGTL + å‹èªè­˜ãƒ‘ãƒ¼ã‚µãƒ¼
â”œâ”€â”€ C++ â†’ PEGTL + ã‚«ã‚¹ã‚¿ãƒ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ‘ãƒ¼ã‚µãƒ¼
â”œâ”€â”€ Python â†’ æ–‡å­—åˆ—ãƒ™ãƒ¼ã‚¹ï¼ˆã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆè§£æï¼‰
â””â”€â”€ C# â†’ PEGTL + Unityç‰¹åŒ–æ‹¡å¼µ
```

## ğŸ® å®Ÿéš›ã«ä½¿ã£ã¦ã¿ã‚‹

```bash
git clone https://github.com/moe-charm/nekocode.git
cd nekocode
mkdir build && cd build
cmake .. && make -j
./nekocode_ai analyze /path/to/your/project
```

## ğŸ”¥ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã®ã‚³ãƒ„

### 1. è¨ˆæ¸¬ã€è¨ˆæ¸¬ã€è¨ˆæ¸¬
```cpp
auto start = std::chrono::high_resolution_clock::now();
// å‡¦ç†
auto end = std::chrono::high_resolution_clock::now();
```

### 2. é©æé©æ‰€
- **PEGTL**: æ§‹é€ åŒ–ã•ã‚ŒãŸãƒ‘ãƒ¼ã‚¹
- **æ–‡å­—åˆ—å‡¦ç†**: ã‚·ãƒ³ãƒ—ãƒ«ãªæ¤œç´¢
- **æœ€å°é™ã®regex**: ã©ã†ã—ã¦ã‚‚å¿…è¦ãªå ´åˆã®ã¿

### 3. ä¸¦åˆ—å‡¦ç†ã®æ´»ç”¨
```cpp
#pragma omp parallel for
for (const auto& file : files) {
    analyze_file(file);
}
```

## ğŸ“ˆ ä»Šå¾Œã®å±•æœ›

- Tree-sitterå®Œå…¨çµ±åˆã§ã•ã‚‰ãªã‚‹ASTè§£æ
- Goã€Rustã€Javaå¯¾å¿œ
- ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ™ãƒ¼ã‚¹ã®å¤§è¦æ¨¡è§£æ

## ğŸ’­ ã¾ã¨ã‚

std::regexã‚’æ¨ã¦ã‚‹ã®ã¯å‹‡æ°—ãŒå¿…è¦ã§ã—ãŸã€‚ã ã£ã¦ã€Œæ¨™æº–ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã‹ã‚‰ã€‚ã§ã‚‚ã€æ™‚ã«ã¯æ¨™æº–ãŒæœ€å–„ã§ã¯ãªã„ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚

**çµæœï¼š**
- **100å€ã®é«˜é€ŸåŒ–**
- **ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã‚¼ãƒ­**
- **590å€ã®æ¤œå‡ºç²¾åº¦å‘ä¸Š**
- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼ˆç‰¹ã«AIé–‹ç™ºè€…ï¼‰å¤§å–œã³**

std::regexã¨ã®æˆ¦ã„ã¯çµ‚ã‚ã‚Šã¾ã—ãŸã€‚æ¬¡ã®æˆ¦ã„ã¯ã€ã•ã‚‰ãªã‚‹é«˜é€ŸåŒ–ã§ã™ã€‚

---

*æ°—ã«å…¥ã£ãŸã‚‰[NekoCode](https://github.com/moe-charm/nekocode)ã«ã‚¹ã‚¿ãƒ¼ã‚’ãŠé¡˜ã„ã—ã¾ã™ï¼â­*

*C++ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®å†’é™ºã‚’ã‚‚ã£ã¨è¦‹ãŸã„æ–¹ã¯[@CharmNexusCore](https://x.com/CharmNexusCore)ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ï¼*

## ğŸ± ãŠã¾ã‘ï¼šé–‹ç™ºä¸­ã®å«ã³

```
ç§ã€Œãªã‚“ã§TypeScriptã§4é–¢æ•°ã—ã‹æ¤œå‡ºã§ããªã„ã‚“ã ï¼ã€
PEGTLã€Œstd::regexä½¿ã£ã¦ã‚‹ã‹ã‚‰ã§ã¯ï¼Ÿã€
ç§ã€Œ...ã€
ï¼ˆ1é€±é–“å¾Œï¼‰
ç§ã€Œ2,362é–¢æ•°æ¤œå‡ºã§ããŸï¼ï¼ï¼ã€
PEGTLã€Œã ã‹ã‚‰è¨€ã£ãŸã§ã—ã‚‡ã€
```