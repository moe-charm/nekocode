# ğŸ”´ C++ è§£ææˆ¦ç•¥ - æœ€çµ‚ãƒœã‚¹æˆ¦

## ğŸ¯ è¨€èªç‰¹æ€§ã¨èª²é¡Œ

### **C++ã¯å…¨è¨€èªä¸­æœ€å‡¶ã®æ•µ**
```cpp
namespace std {
    template<typename T, typename Alloc = std::allocator<T>>
    class vector {
    public:
        template<typename... Args>
        constexpr decltype(auto) emplace_back(Args&&... args) 
            noexcept(std::is_nothrow_constructible_v<T, Args...>)
            -> reference;
    };
}
```

### **C++ç‰¹æœ‰ã®åœ°ç„**
| å•é¡Œ | ä¾‹ | é›£æ˜“åº¦ |
|------|----|----|
| **ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ** | `template<class T, int N = 5>` | ğŸ˜±ğŸ˜±ğŸ˜± |
| **åå‰ç©ºé–“** | `namespace nested::deep::hell {}` | ğŸ˜±ğŸ˜± |
| **ãƒ—ãƒªãƒ—ãƒ­ã‚»ãƒƒã‚µ** | `#define MACRO(x) ...` | ğŸ˜±ğŸ˜±ğŸ˜± |
| **å¤šé‡ç¶™æ‰¿** | `class D : public A, private B` | ğŸ˜±ğŸ˜± |
| **constä¿®é£¾** | `const int& func() const noexcept` | ğŸ˜±ğŸ˜± |
| **ãƒ˜ãƒƒãƒ€ãƒ¼åˆ†é›¢** | å®£è¨€ã¨å®šç¾©ãŒåˆ¥ãƒ•ã‚¡ã‚¤ãƒ« | ğŸ˜±ğŸ˜± |

## ğŸ”§ æ¡ç”¨æˆ¦ç•¥: æ®µéšçš„é™ä¼ä½œæˆ¦

### **Phase 1: æ¥µå°æ–‡æ³•ã§æœ€ä½é™æ¤œå‡º**
```cpp
// ç›®æ¨™: å®Œç’§è§£æã¯è«¦ã‚ã€å­˜åœ¨æ¤œå‡ºã®ã¿
struct simple_class : seq<
    star<space>,  // ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆè¨±å¯
    class_keyword,
    required_ws,
    identifier,
    star<space>,
    block  // å†…å®¹ã¯èª­ã¿é£›ã°ã™
> {};
```

**æ¤œå‡ºç›®æ¨™:**
- âœ… `class ClassName {` - åŸºæœ¬ã‚¯ãƒ©ã‚¹
- âœ… `struct StructName {` - æ§‹é€ ä½“
- âœ… `namespace ns {` - åå‰ç©ºé–“
- â“ `int function()` - æˆ»ã‚Šå€¤å‹ä»˜ãé–¢æ•°

### **Phase 2: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç„¡è¦–æˆ¦ç•¥**
```cpp
// ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¯ã€Œãƒã‚¤ã‚ºã€ã¨ã—ã¦å®Œå…¨ã‚¹ã‚­ãƒƒãƒ—
struct template_noise : seq<
    TAO_PEGTL_STRING("template"),
    one<'<'>,
    until<one<'>'>>  // template<...> å…¨éƒ¨ç„¡è¦–
> {};

struct class_with_template : seq<
    star<space>,
    opt<template_noise>,  // â† ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç„¡è¦–
    star<space>,
    class_keyword,
    // ... ä»¥ä¸‹åŒã˜
> {};
```

### **Phase 3: ãƒ—ãƒªãƒ—ãƒ­ã‚»ãƒƒã‚µå‰å‡¦ç†**
```cpp
// #include, #defineç­‰ã‚’äº‹å‰é™¤å»
std::string preprocess(const std::string& content) {
    std::vector<std::string> lines;
    std::istringstream stream(content);
    std::string line;
    
    while (std::getline(stream, line)) {
        if (!line.starts_with("#")) {  // ãƒ—ãƒªãƒ—ãƒ­ã‚»ãƒƒã‚µè¡Œã‚’é™¤å»
            lines.push_back(line);
        }
    }
    return join(lines, "\n");
}
```

## ğŸš¨ ç¾åœ¨ã®æ·±åˆ»ãªå•é¡Œ

**2025-07-28æ™‚ç‚¹:**
```cpp
// ã“ã®æœ€å°é™ã®C++ã™ã‚‰æ¤œå‡ºã§ããªã„çŠ¶æ³
class TestClass {
};
// â†’ total_classes: 0
```

**è€ƒãˆã‚‰ã‚Œã‚‹åŸå› :**
1. **PEGTLæ–‡æ³•ã®æ ¹æœ¬çš„ãªæ¬ é™¥**
2. **ã‚¢ã‚¯ã‚·ãƒ§ãƒ³é–¢æ•°ã®æœªå®Ÿè¡Œ**
3. **ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ«ã®æ§‹é€ å•é¡Œ**

## ğŸ”§ ç·Šæ€¥ãƒ‡ãƒãƒƒã‚°è¨ˆç”»

### **Step 1: æœ€å°é™æ¤œè¨¼**
```cpp
// ã“ã‚Œã ã‘ã§ã‚‚æ¤œå‡ºã§ãã‚‹ã‹ï¼Ÿ
class A{};
```

### **Step 2: ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å‹•ä½œç¢ºèª**
```cpp
template<>
struct cpp_action<cpp::minimal_grammar::simple_class> {
    static void apply(...) {
        std::cerr << "CLASS DETECTED!" << std::endl;  // â† ã“ã®å‡ºåŠ›ãŒå‡ºã‚‹ã‹ï¼Ÿ
    }
};
```

### **Step 3: ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿè£…**
```cpp
// PEGTLå®Œå…¨å¤±æ•—æ™‚ã®ç·Šæ€¥å¯¾å¿œ
if (pegtl_classes.empty() && pegtl_functions.empty()) {
    // æ­£è¦è¡¨ç¾ã«ã‚ˆã‚‹å¼·åˆ¶æ¤œå‡º
    std::regex class_regex("^\\s*class\\s+(\\w+)");
    // ... æ³¥è‡­ã„å®Ÿè£…ã§ç¢ºå®Ÿã«æ¤œå‡º
}
```

## ğŸ“Š ç›®æ¨™è¨­å®š

| ãƒ•ã‚¡ã‚¤ãƒ« | è¤‡é›‘åº¦ | ç¾çŠ¶ | æœ€ä½ç›®æ¨™ | ç†æƒ³ç›®æ¨™ |
|----------|--------|------|----------|----------|
| **test_cpp_simple.cpp** | ä½ | 0æ¤œå‡º | 3ã‚¯ãƒ©ã‚¹+2é–¢æ•° | å®Œå…¨æ¤œå‡º |
| **nlohmann/json.hpp** | è¶…é«˜ | 0æ¤œå‡º | 10+è¦ç´  | 100+è¦ç´  |

## ğŸ’­ è¨­è¨ˆå“²å­¦

### **ã€Œå®Œç’§ä¸»ç¾©ã‚’æ¨ã¦ã‚‹ã€**
```cpp
// âŒ ç›®æŒ‡ã•ãªã„: å®Œç’§ãªC++ãƒ‘ãƒ¼ã‚µãƒ¼
// âœ… ç›®æŒ‡ã™: å®Ÿç”¨çš„ãªè¦ç´ æ¤œå‡ºå™¨

// è«¦ã‚ã‚‹éƒ¨åˆ†:
// - ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç‰¹æ®ŠåŒ–ã®æ­£ç¢ºãªè§£æ
// - è¤‡é›‘ãªç¶™æ‰¿é–¢ä¿‚ã®è¿½è·¡  
// - ãƒã‚¯ãƒ­å±•é–‹å¾Œã®æ§‹é€ è§£æ
// - ADL (Argument Dependent Lookup)

// é‡è¦–ã™ã‚‹éƒ¨åˆ†:
// - ã‚¯ãƒ©ã‚¹åã¨é–¢æ•°åã®å­˜åœ¨ç¢ºèª
// - å¤§ã¾ã‹ãªæ§‹é€ ã®æŠŠæ¡
// - çµ±è¨ˆæƒ…å ±ã®å¦¥å½“æ€§
```

## ğŸ’¡ å®Ÿè£…ãƒ¡ãƒ¢

**ç¾åœ¨ã®çŠ¶æ³:**
- âœ… C++ PEGTLã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼ã¯å‘¼ã°ã‚Œã¦ã„ã‚‹
- âœ… è¡Œæ•°ã‚«ã‚¦ãƒ³ãƒˆã¯æ­£å¸¸å‹•ä½œ
- âŒ ã‚¯ãƒ©ã‚¹ãƒ»é–¢æ•°æ¤œå‡ºãŒå®Œå…¨ã«å¤±æ•—
- ğŸš¨ æ ¹æœ¬çš„ãªPEGTLæ–‡æ³•ã®è¦‹ç›´ã—ãŒå¿…è¦

**æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³:**
1. æœ€å°é™ã®C++ã§ãƒ‡ãƒãƒƒã‚°å‡ºåŠ›ç¢ºèª
2. ã‚¢ã‚¯ã‚·ãƒ§ãƒ³é–¢æ•°ã®å‹•ä½œæ¤œè¨¼
3. å¿…è¦ã«å¿œã˜ã¦ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿè£…

**æ•™è¨“:**
ã€ŒC++ã®è¤‡é›‘ã•ã‚’èˆã‚ã¦ãŸã€‚ã§ã‚‚è«¦ã‚ãªã„ã€‚ã€