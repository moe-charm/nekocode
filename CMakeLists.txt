cmake_minimum_required(VERSION 3.16)
project(NekoCodeCpp VERSION 1.0.0 LANGUAGES C CXX)

#=============================================================================
# ğŸ± NekoCode C++ - é«˜é€Ÿè§£æãƒ„ãƒ¼ãƒ«
#
# å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ï¼’å€‹å¤§ä½œæˆ¦ï¼š
# - nekocode_ai: AI/Claudeç”¨JSONå‡ºåŠ›
#
# Pythonç‰ˆã‹ã‚‰ã®å¤§å¹…æ€§èƒ½å‘ä¸Š:
# - 10-100å€é«˜é€ŸåŒ–
# - ä½ãƒ¡ãƒ¢ãƒªæ¶ˆè²»
# - ä¸¦åˆ—å‡¦ç†å¯¾å¿œ
#=============================================================================

# C++20å¿…é ˆï¼ˆstring::starts_with/ends_withå¯¾å¿œï¼‰
set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# std::regexä½¿ç”¨é˜²æ­¢ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆé–‹ç™ºè€…å‘ã‘è­¦å‘Šï¼‰
option(NEKOCODE_PREVENT_REGEX "Prevent std::regex usage" ON)
if(NEKOCODE_PREVENT_REGEX)
    add_compile_definitions(NEKOCODE_PREVENT_REGEX)
    message(STATUS "âš ï¸  std::regex prevention enabled - Use PEGTL instead!")
endif()

# ğŸŒŸ Universal AST Revolution ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆ6è¨€èªçµ±ä¸€ã‚·ã‚¹ãƒ†ãƒ ï¼‰
option(NEKOCODE_ENABLE_UNIVERSAL_AST "Enable Universal AST system for all 6 languages" OFF)
if(NEKOCODE_ENABLE_UNIVERSAL_AST)
    add_compile_definitions(NEKOCODE_USE_UNIVERSAL_AST=1)
    message(STATUS "ğŸŒŸ Universal AST Revolution enabled - 6è¨€èªçµ±ä¸€ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•!")
endif()

# ğŸ§  Memory System ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆæ™‚é–“è»¸Memoryé©å‘½ï¼‰
option(NEKOCODE_ENABLE_MEMORY_SYSTEM "Enable Memory System for analysis result persistence" ON)
if(NEKOCODE_ENABLE_MEMORY_SYSTEM)
    add_compile_definitions(NEKOCODE_USE_MEMORY_SYSTEM=1)
    message(STATUS "ğŸ§  Memory System enabled - æ™‚é–“è»¸Memoryé©å‘½èµ·å‹•!")
endif()

# ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãƒ¼è­¦å‘Šè¨­å®š
if(MSVC)
    add_compile_options(/W4)
else()
    add_compile_options(-Wall -Wextra -Wpedantic -Wno-unused-parameter -Wno-unused-variable)
endif()

# æœ€é©åŒ–è¨­å®š
if(CMAKE_BUILD_TYPE STREQUAL "Release")
    add_compile_options(-O3 -DNDEBUG)
    message(STATUS "ğŸš€ Release build: æœ€å¤§æœ€é©åŒ–ãƒ¢ãƒ¼ãƒ‰")
elseif(CMAKE_BUILD_TYPE STREQUAL "Debug")
    add_compile_options(-g -DDEBUG)
    message(STATUS "ğŸ› Debug build: ãƒ‡ãƒãƒƒã‚°ãƒ¢ãƒ¼ãƒ‰")
endif()

if(NOT CMAKE_BUILD_TYPE)
    set(CMAKE_BUILD_TYPE Release)
    message(STATUS "âš¡ Default: Release build")
endif()

#=============================================================================
# ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªè¨­å®š
#=============================================================================

set(INCLUDE_DIR ${CMAKE_CURRENT_SOURCE_DIR}/include)
set(SRC_DIR ${CMAKE_CURRENT_SOURCE_DIR}/src)

# ğŸ¯ å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›å…ˆã‚’bin/ãƒ•ã‚©ãƒ«ãƒ€ã«è¨­å®šï¼ˆGeminiã‚¯ãƒ©ãƒƒã‚·ãƒ¥å¯¾ç­–ç‰ˆã‚’å®‰å…¨ã«é…å‚™ï¼‰
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/bin)

# ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ãƒ‰ãƒ‘ã‚¹
include_directories(${INCLUDE_DIR})

#=============================================================================
# ğŸ“¦ External Dependencies
#=============================================================================

# nlohmann/json for JSON formatting
find_package(nlohmann_json QUIET)
if(NOT nlohmann_json_FOUND)
    message(STATUS "ğŸ“¦ nlohmann/json not found, using single header")
    include(FetchContent)
    FetchContent_Declare(
        nlohmann_json
        URL https://github.com/nlohmann/json/releases/download/v3.11.2/json.tar.xz
    )
    FetchContent_MakeAvailable(nlohmann_json)
endif()

# UTF8-CPP for Unicode support
message(STATUS "ğŸŒ Fetching UTF8-CPP for Unicode support...")
include(FetchContent)
FetchContent_Declare(
    utf8cpp
    GIT_REPOSITORY https://github.com/nemtrif/utfcpp.git
    GIT_TAG v3.2.4
)
FetchContent_MakeAvailable(utf8cpp)

# ğŸ”¥ PEGTL - è»½é‡é«˜æ€§èƒ½ãƒ‘ãƒ¼ã‚µãƒ¼ãƒ©ã‚¤ãƒ–ãƒ©ãƒªçµ±åˆ
message(STATUS "ğŸ”¥ Fetching PEGTL for advanced parsing...")
include(FetchContent)
FetchContent_Declare(
    pegtl
    GIT_REPOSITORY https://github.com/taocpp/PEGTL.git
    GIT_TAG 3.2.7
)
FetchContent_MakeAvailable(pegtl)

# ğŸŒ³ Tree-sitter Phase 3: ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼çµ±åˆï¼ˆPEGTLç§»è¡Œäºˆå®šï¼‰
message(STATUS "ğŸŒ³ Tree-sitter placeholder integration (migrating to PEGTL)")

# ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ç”¨Tree-sitterãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆæš«å®šç¶­æŒï¼‰
add_library(tree-sitter-core STATIC ${SRC_DIR}/legacy/tree_sitter_placeholder.c)
target_include_directories(tree-sitter-core PUBLIC
    ${CMAKE_CURRENT_SOURCE_DIR}/include
)

# è¨€èªçµ±åˆç”¨ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ï¼‰
add_library(tree-sitter-langs INTERFACE)

# Threads for parallel processing
find_package(Threads REQUIRED)

#=============================================================================
# ğŸ§  NekoCode Core Library
#=============================================================================

# ğŸ¯ ã‚³ã‚¢ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚½ãƒ¼ã‚¹ï¼ˆæ–°æ§‹é€ å¯¾å¿œï¼‰
set(NEKOCODE_SOURCES
    # Coreæ©Ÿèƒ½
    ${SRC_DIR}/core/core.cpp
    ${SRC_DIR}/core/language_detection.cpp
    ${SRC_DIR}/core/session_manager.cpp
    ${SRC_DIR}/core/session_data.cpp
    ${SRC_DIR}/core/config_manager.cpp
    # SessionCommandsåˆ†å‰²å¾Œãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ï¼ˆå®Ÿè£…ä¿æŒå®Œäº†ï¼‰
    ${SRC_DIR}/core/cmd/basic_commands.cpp
    ${SRC_DIR}/core/cmd/structure_commands.cpp
    ${SRC_DIR}/core/cmd/include_commands.cpp
    ${SRC_DIR}/core/cmd/search_commands.cpp
    ${SRC_DIR}/core/cmd/ast_commands.cpp
    
    # ãƒ•ã‚©ãƒ¼ãƒãƒƒã‚¿ãƒ¼
    ${SRC_DIR}/formatters/formatters.cpp
    
    # ğŸš€ Phase 5å®Œäº†: Symbol Converterå±¤å‰Šé™¤æ¸ˆã¿
    # Phase 5ã§å…¨ã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼ãŒç›´æ¥ç”Ÿæˆã™ã‚‹ãŸã‚Converterå±¤ä¸è¦
    # Phase 3: Symbol Converters
    # ${SRC_DIR}/converters/rust_symbol_converter.cpp
    # 
    # Phase 4: Symbol Converters  
    # ${SRC_DIR}/converters/js_symbol_converter.cpp
    # ${SRC_DIR}/converters/python_symbol_converter.cpp
    # ${SRC_DIR}/converters/cpp_symbol_converter.cpp
    # ${SRC_DIR}/converters/csharp_symbol_converter.cpp
    
    # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
    ${SRC_DIR}/utils/utf8_utils.cpp
    ${SRC_DIR}/utils/include_analyzer.cpp
    ${SRC_DIR}/utils/progress_tracker.cpp
    
    # ãƒ•ã‚¡ã‚¤ãƒ³ãƒ€ãƒ¼æ©Ÿèƒ½
    ${SRC_DIR}/finders/symbol_finder.cpp
    
    # ä¾å­˜é–¢ä¿‚è§£æ
    ${SRC_DIR}/core/dependency_graph.cpp
    
    # ã‚³ãƒãƒ³ãƒ‰
    ${SRC_DIR}/commands/find_command.cpp
    
    # ğŸ”¥ Direct Editæ©Ÿèƒ½ï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸è¦ï¼‰
    ${SRC_DIR}/core/commands/direct_edit/direct_replace.cpp
    ${SRC_DIR}/core/commands/direct_edit/direct_insert.cpp
    ${SRC_DIR}/core/commands/direct_edit/direct_movelines.cpp
    
    # ğŸ§  Memory System - æ™‚é–“è»¸Memoryé©å‘½ï¼ˆæ¡ä»¶ä»˜ãã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ï¼‰
    $<$<BOOL:${NEKOCODE_ENABLE_MEMORY_SYSTEM}>:${SRC_DIR}/memory/memory_system.cpp>
    $<$<BOOL:${NEKOCODE_ENABLE_MEMORY_SYSTEM}>:${SRC_DIR}/commands/memory_command.cpp>
    
    # ãƒ¬ã‚¬ã‚·ãƒ¼ï¼ˆå¿…è¦ã«å¿œã˜ã¦å‰Šé™¤äºˆå®šï¼‰
    ${SRC_DIR}/legacy/tree_sitter_analyzer.cpp
    ${SRC_DIR}/legacy/pegtl_analyzer.cpp
    
    # è¨€èªåˆ¥ã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼ï¼ˆæ–°æ§‹é€ ï¼‰
    ${SRC_DIR}/analyzers/analyzer_factory.cpp
    ${SRC_DIR}/analyzers/python/python_analyzer.cpp
    # ${SRC_DIR}/analyzers/javascript/javascript_analyzer.cpp # regexç‰ˆã¯å‰Šé™¤æ¸ˆã¿
    ${SRC_DIR}/analyzers/cpp/cpp_language_analyzer.cpp
    ${SRC_DIR}/analyzers/cpp/cpp_analyzer.cpp
    # ${SRC_DIR}/analyzers/csharp/csharp_analyzer.cpp # regexç‰ˆã¯å‰Šé™¤æ¸ˆã¿
    ${SRC_DIR}/analyzers/csharp/csharp_pegtl_analyzer.cpp
    ${SRC_DIR}/analyzers/unity/unity_analyzer.cpp
    ${SRC_DIR}/analyzers/go/go_analyzer.cpp
    ${SRC_DIR}/analyzers/rust/rust_analyzer.cpp
    
    # ğŸŒŸ Universal AST Revolution - 6è¨€èªçµ±ä¸€ã‚·ã‚¹ãƒ†ãƒ ï¼ˆæ¡ä»¶ä»˜ãã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ï¼‰
    $<$<BOOL:${NEKOCODE_ENABLE_UNIVERSAL_AST}>:${SRC_DIR}/universal/universal_tree_builder.cpp>
    $<$<BOOL:${NEKOCODE_ENABLE_UNIVERSAL_AST}>:${SRC_DIR}/universal/language_traits.cpp>
    $<$<BOOL:${NEKOCODE_ENABLE_UNIVERSAL_AST}>:${SRC_DIR}/universal/universal_code_analyzer.cpp>
    $<$<BOOL:${NEKOCODE_ENABLE_UNIVERSAL_AST}>:${SRC_DIR}/adapters/javascript_universal_adapter.cpp>
    $<$<BOOL:${NEKOCODE_ENABLE_UNIVERSAL_AST}>:${SRC_DIR}/adapters/python_universal_adapter.cpp>
    $<$<BOOL:${NEKOCODE_ENABLE_UNIVERSAL_AST}>:${SRC_DIR}/adapters/cpp_universal_adapter.cpp>
    $<$<BOOL:${NEKOCODE_ENABLE_UNIVERSAL_AST}>:${SRC_DIR}/adapters/csharp_universal_adapter.cpp>
    $<$<BOOL:${NEKOCODE_ENABLE_UNIVERSAL_AST}>:${SRC_DIR}/adapters/go_universal_adapter.cpp>
    $<$<BOOL:${NEKOCODE_ENABLE_UNIVERSAL_AST}>:${SRC_DIR}/adapters/rust_universal_adapter.cpp>
)

# ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«
set(NEKOCODE_HEADERS
    ${INCLUDE_DIR}/nekocode/types.hpp
    ${INCLUDE_DIR}/nekocode/core.hpp
    ${INCLUDE_DIR}/nekocode/tree_sitter_analyzer.hpp
    ${INCLUDE_DIR}/nekocode/pegtl_analyzer.hpp
    ${INCLUDE_DIR}/nekocode/formatters.hpp
    ${INCLUDE_DIR}/nekocode/utf8_utils.hpp
    ${INCLUDE_DIR}/nekocode/language_detection.hpp
    ${INCLUDE_DIR}/nekocode/cpp_analyzer.hpp
    ${INCLUDE_DIR}/nekocode/session_manager.hpp
    ${INCLUDE_DIR}/nekocode/include_analyzer.hpp
    ${INCLUDE_DIR}/nekocode/symbol_finder.hpp
    ${INCLUDE_DIR}/nekocode/progress_tracker.hpp
    # è¨€èªåˆ¥ã‚¢ãƒŠãƒ©ã‚¤ã‚¶ãƒ¼ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆæ–°æ§‹é€ å¯¾å¿œï¼‰
    ${SRC_DIR}/analyzers/base_analyzer.hpp
    ${SRC_DIR}/analyzers/javascript/javascript_pegtl_analyzer.hpp
    ${SRC_DIR}/analyzers/javascript/javascript_minimal_grammar.hpp
    ${INCLUDE_DIR}/nekocode/analyzers/python_analyzer.hpp
    ${INCLUDE_DIR}/nekocode/analyzers/cpp_language_analyzer.hpp
    ${INCLUDE_DIR}/nekocode/analyzers/unity_analyzer.hpp
    ${INCLUDE_DIR}/nekocode/analyzers/unity_patterns.hpp
    ${INCLUDE_DIR}/nekocode/analyzers/unity_components.hpp
    ${INCLUDE_DIR}/nekocode/analyzers/go_analyzer.hpp
    ${INCLUDE_DIR}/nekocode/analyzers/rust_analyzer.hpp
    
    # ğŸ§  Memory System Headersï¼ˆæ¡ä»¶ä»˜ãï¼‰
    $<$<BOOL:${NEKOCODE_ENABLE_MEMORY_SYSTEM}>:${SRC_DIR}/memory/memory_system.hpp>
    $<$<BOOL:${NEKOCODE_ENABLE_MEMORY_SYSTEM}>:${INCLUDE_DIR}/nekocode/memory_command.hpp>
    
    # ğŸŒŸ Universal AST Revolution ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆæ¡ä»¶ä»˜ãï¼‰
    $<$<BOOL:${NEKOCODE_ENABLE_UNIVERSAL_AST}>:${SRC_DIR}/universal/universal_tree_builder.hpp>
    $<$<BOOL:${NEKOCODE_ENABLE_UNIVERSAL_AST}>:${SRC_DIR}/universal/language_traits.hpp>
    $<$<BOOL:${NEKOCODE_ENABLE_UNIVERSAL_AST}>:${SRC_DIR}/universal/universal_code_analyzer.hpp>
    $<$<BOOL:${NEKOCODE_ENABLE_UNIVERSAL_AST}>:${SRC_DIR}/adapters/javascript_universal_adapter.hpp>
    $<$<BOOL:${NEKOCODE_ENABLE_UNIVERSAL_AST}>:${SRC_DIR}/adapters/python_universal_adapter.hpp>
    $<$<BOOL:${NEKOCODE_ENABLE_UNIVERSAL_AST}>:${SRC_DIR}/adapters/cpp_universal_adapter.hpp>
    $<$<BOOL:${NEKOCODE_ENABLE_UNIVERSAL_AST}>:${SRC_DIR}/adapters/csharp_universal_adapter.hpp>
    $<$<BOOL:${NEKOCODE_ENABLE_UNIVERSAL_AST}>:${SRC_DIR}/adapters/go_universal_adapter.hpp>
    $<$<BOOL:${NEKOCODE_ENABLE_UNIVERSAL_AST}>:${SRC_DIR}/adapters/rust_universal_adapter.hpp>
)

# é™çš„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä½œæˆ
add_library(nekocode_static STATIC ${NEKOCODE_SOURCES} ${NEKOCODE_HEADERS})
target_include_directories(nekocode_static PUBLIC 
    ${INCLUDE_DIR}
    ${CMAKE_CURRENT_SOURCE_DIR}/include
    ${SRC_DIR}/analyzers
    ${SRC_DIR}/include
    $<$<BOOL:${NEKOCODE_ENABLE_UNIVERSAL_AST}>:${SRC_DIR}/universal>
    $<$<BOOL:${NEKOCODE_ENABLE_UNIVERSAL_AST}>:${SRC_DIR}/adapters>
    $<$<BOOL:${NEKOCODE_ENABLE_UNIVERSAL_AST}>:${SRC_DIR}>
)
target_link_libraries(nekocode_static 
    nlohmann_json::nlohmann_json 
    utf8::cpp
    tree-sitter-core
    tree-sitter-langs
    taocpp::pegtl
    Threads::Threads
)

# C++20 features
target_compile_features(nekocode_static PUBLIC cxx_std_20)

#=============================================================================
# ğŸ¤– AI Tool - Claude Codeæœ€é©åŒ–å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«
#=============================================================================

add_executable(nekocode_ai 
    ${SRC_DIR}/main/main_ai.cpp
    ${SRC_DIR}/main/command_dispatcher.cpp
    ${SRC_DIR}/main/command_line_args.cpp
)
target_link_libraries(nekocode_ai nekocode_static)

# AIç”¨ç‰¹åˆ¥æœ€é©åŒ–
target_compile_definitions(nekocode_ai PRIVATE 
    NEKOCODE_AI_MODE=1
    NEKOCODE_PERFORMANCE_PRIORITY=1
)


#=============================================================================
# ğŸ§ª Tests
#=============================================================================

option(BUILD_TESTS "Build test suite" ON)
if(BUILD_TESTS)
    enable_testing()
    
    # ç°¡æ˜“ãƒ†ã‚¹ãƒˆï¼ˆãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹å ´åˆã®ã¿ï¼‰
    # add_executable(test_core ${CMAKE_CURRENT_SOURCE_DIR}/tests/test_core.cpp)
    # target_link_libraries(test_core nekocode_static)
    # add_test(NAME CoreTest COMMAND test_core)
    
    # add_executable(test_performance ${CMAKE_CURRENT_SOURCE_DIR}/tests/test_performance.cpp)
    # target_link_libraries(test_performance nekocode_static)
    # add_test(NAME PerformanceTest COMMAND test_performance)
endif()

#=============================================================================
# ğŸ“¦ Install Configuration
#=============================================================================

option(ENABLE_INSTALL "Enable install target" ON)
if(ENABLE_INSTALL)
    # å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
    install(TARGETS nekocode_ai
        RUNTIME DESTINATION bin
    )
    
    # ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ã—ã¦ä½¿ç”¨æ™‚ï¼‰
    install(DIRECTORY ${INCLUDE_DIR}/nekocode
        DESTINATION include
        FILES_MATCHING PATTERN "*.hpp"
    )
    
    # ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
    install(TARGETS nekocode_static
        ARCHIVE DESTINATION lib
    )
endif()

#=============================================================================
# ğŸ”§ Development Tools
#=============================================================================

# Clang-tidyï¼ˆã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯ï¼‰
option(ENABLE_CLANG_TIDY "Enable clang-tidy checks" OFF)
if(ENABLE_CLANG_TIDY)
    find_program(CLANG_TIDY_EXE NAMES "clang-tidy")
    if(CLANG_TIDY_EXE)
        set(CMAKE_CXX_CLANG_TIDY "${CLANG_TIDY_EXE}")
        message(STATUS "âœ… clang-tidy enabled")
    else()
        message(STATUS "âŒ clang-tidy not found")
    endif()
endif()

# Address Sanitizerï¼ˆãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯ãƒã‚§ãƒƒã‚¯ï¼‰
option(ENABLE_ASAN "Enable AddressSanitizer" OFF)
if(ENABLE_ASAN)
    target_compile_options(nekocode_static PRIVATE -fsanitize=address -fno-omit-frame-pointer)
    target_link_options(nekocode_static PRIVATE -fsanitize=address)
    message(STATUS "ğŸ›¡ï¸ AddressSanitizer enabled")
endif()

# Thread Sanitizerï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ¬ãƒ¼ã‚¹ãƒã‚§ãƒƒã‚¯ï¼‰
option(ENABLE_TSAN "Enable ThreadSanitizer" OFF)
if(ENABLE_TSAN)
    target_compile_options(nekocode_static PRIVATE -fsanitize=thread)
    target_link_options(nekocode_static PRIVATE -fsanitize=thread)
    message(STATUS "ğŸ”’ ThreadSanitizer enabled")
endif()

#=============================================================================
# ğŸ“Š Build Summary
#=============================================================================

message(STATUS "")
message(STATUS "ğŸ± NekoCode C++ Build Configuration:")
message(STATUS "   Build Type: ${CMAKE_BUILD_TYPE}")
message(STATUS "   C++ Standard: ${CMAKE_CXX_STANDARD}")
message(STATUS "   Tests: ${BUILD_TESTS}")
message(STATUS "   Install Target: ${ENABLE_INSTALL}")
message(STATUS "")
message(STATUS "ğŸ¯ å®Ÿè¡Œãƒ•ã‚¡ã‚¤ãƒ«ï¼’å€‹å¤§ä½œæˆ¦:")
message(STATUS "   ğŸ¤– nekocode_ai     - AI/Claudeç”¨JSONå‡ºåŠ›")
message(STATUS "")
message(STATUS "âš¡ Pythonç‰ˆã‹ã‚‰ã®é©å‘½çš„æ”¹å–„:")
message(STATUS "   ğŸ“ˆ æ€§èƒ½: 10-100å€é«˜é€ŸåŒ–")
message(STATUS "   ğŸ§  ãƒ¡ãƒ¢ãƒª: å¤§å¹…å‰Šæ¸›")
message(STATUS "   ğŸš€ ä¸¦åˆ—: ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰å¯¾å¿œ")
message(STATUS "   ğŸ”’ å‹å®‰å…¨: ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«æ™‚ãƒã‚§ãƒƒã‚¯")
message(STATUS "")

#=============================================================================
# ğŸš€ Quick Build Commands
#=============================================================================

# ã‚«ã‚¹ã‚¿ãƒ ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ: ä¸¡æ–¹ãƒ“ãƒ«ãƒ‰
add_custom_target(build_all
    COMMAND ${CMAKE_COMMAND} --build ${CMAKE_BINARY_DIR} --target nekocode_ai --parallel
    COMMENT "ğŸš€ Build both AI and Human tools"
)

# ã‚«ã‚¹ã‚¿ãƒ ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ: AIå°‚ç”¨ãƒ“ãƒ«ãƒ‰
add_custom_target(build_ai
    COMMAND ${CMAKE_COMMAND} --build ${CMAKE_BINARY_DIR} --target nekocode_ai --parallel
    COMMENT "ğŸ¤– Build AI tool only"
)

# ã‚«ã‚¹ã‚¿ãƒ ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ: Humanå°‚ç”¨ãƒ“ãƒ«ãƒ‰
add_custom_target(build_human
    COMMENT "ğŸ‘¨â€ğŸ’» Build Human tool only"
)

# ã‚«ã‚¹ã‚¿ãƒ ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ: ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
add_custom_target(run_tests
    COMMAND ${CMAKE_COMMAND} --build ${CMAKE_BINARY_DIR} --target test_core --parallel
    COMMAND ./test_core
    WORKING_DIRECTORY ${CMAKE_BINARY_DIR}
    COMMENT "ğŸ§ª Build and run tests"
)

# ã‚«ã‚¹ã‚¿ãƒ ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ
add_custom_target(benchmark
    COMMAND ${CMAKE_COMMAND} --build ${CMAKE_BINARY_DIR} --target test_performance --parallel
    COMMAND ./test_performance
    WORKING_DIRECTORY ${CMAKE_BINARY_DIR}
    COMMENT "âš¡ Run performance benchmark"
)